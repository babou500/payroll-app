<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gambia Professional Payroll System</title>
    <style>
        /* --- 1. DASHBOARD STYLES (Screen View) --- */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        
        .container { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .full-width { grid-column: span 2; }
        
        h2 { margin-top: 0; color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h4 { margin: 15px 0 5px; color: #7f8c8d; border-bottom: 1px dashed #ccc; padding-bottom: 2px; }

        .input-group { margin-bottom: 12px; }
        label { display: block; font-weight: 600; font-size: 0.9em; margin-bottom: 5px; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 14px; }
        input:focus { border-color: #3498db; outline: none; background: #fbfdff; }

        .result-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .total-net { font-size: 1.5em; font-weight: 800; color: #27ae60; border-top: 2px solid #ddd; margin-top: 15px; padding-top: 10px; }
        .text-red { color: #c0392b; }

        button.add-btn { width: 100%; padding: 15px; background: #2c3e50; color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 6px; margin-top: 20px; font-weight: bold; transition: background 0.3s; }
        button.add-btn:hover { background: #34495e; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 8px; overflow: hidden; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        button.print-btn { background: #2980b9; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 4px; font-size: 0.9em; }
        button.print-btn:hover { background: #1f6391; }

        /* --- 2. PAYSLIP STYLES (Print View) --- */
        #print-section { display: none; } 

        @media print {
            body * { visibility: hidden; }
            #print-section, #print-section * { visibility: visible; }
            #print-section {
                display: block; position: absolute; left: 0; top: 0; width: 100%;
                background: white; padding: 40px; box-sizing: border-box;
            }
            .slip-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px; }
            .slip-logo img { max-height: 80px; max-width: 150px; }
            .slip-title h1 { margin: 0; font-size: 26px; color: #2c3e50; text-transform: uppercase; letter-spacing: 1px; }
            .slip-title p { margin: 5px 0 0; color: #7f8c8d; font-size: 14px; }
            
            .slip-info { background: #f8f9fa; padding: 15px; border-left: 6px solid #3498db; margin-bottom: 30px; display: flex; justify-content: space-between; }
            
            .slip-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
            .col-title { font-weight: bold; font-size: 14px; border-bottom: 2px solid #ccc; margin-bottom: 10px; padding-bottom: 5px; color: #444; }
            .slip-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; }
            
            .net-box { margin-top: 40px; background: #2c3e50; color: white; padding: 20px; text-align: center; border-radius: 8px; }
            .net-box p { margin: 0; opacity: 0.8; font-size: 12px; text-transform: uppercase; }
            .net-box h2 { margin: 5px 0 0; font-size: 32px; letter-spacing: 1px; }
            
            .footer { text-align: center; margin-top: 50px; font-size: 11px; color: #aaa; border-top: 1px solid #eee; padding-top: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="card">
        <h2>1. Enter Details</h2>
        
        <div class="input-group">
            <label>Upload Logo (Optional)</label>
            <input type="file" id="logoInput" accept="image/*" onchange="loadLogo()">
        </div>
        
        <div class="input-group">
            <label>Company Name</label>
            <input type="text" id="companyName" value="Your Company Name">
        </div>

        <h4>Employee Info</h4>
        <div class="input-group"><label>Name</label><input type="text" id="empName" placeholder="e.g. Lamin Jatta"></div>
        <div class="input-group"><label>Date</label><input type="date" id="payDate"></div>
        <div class="input-group"><label>Basic Monthly Salary (GMD)</label><input type="number" id="basic" value="0" oninput="calculate()"></div>

        <h4>Monthly Allowances</h4>
        <div class="input-group"><label>Transport</label><input type="number" id="all_trans" value="0" oninput="calculate()"></div>
        <div class="input-group"><label>Housing / Rent</label><input type="number" id="all_house" value="0" oninput="calculate()"></div>
        <div class="input-group"><label>Other Allowances</label><input type="number" id="all_other" value="0" oninput="calculate()"></div>

        <h4>Deductions</h4>
        <div class="input-group"><label>Staff Loan</label><input type="number" id="ded_loan" value="0" oninput="calculate()"></div>
        <div class="input-group"><label>Other Deductions</label><input type="number" id="ded_other" value="0" oninput="calculate()"></div>
    </div>

    <div class="card">
        <h2>2. Live Calculation</h2>
        <div id="results">
            <div class="result-row"><span>Basic Salary:</span> <span id="r_basic">0.00</span></div>
            <div class="result-row"><span>Total Allowances:</span> <span id="r_allow">0.00</span></div>
            <div class="result-row" style="font-weight:bold; color:#2980b9;"><span>MONTHLY GROSS:</span> <span id="r_gross">0.00</span></div>
            <br>
            <div class="result-row text-red"><span>NPF (5%):</span> <span id="r_npf">0.00</span></div>
            <div class="result-row text-red"><span>PAYE Tax (Annualized):</span> <span id="r_tax">0.00</span></div>
            <div class="result-row text-red"><span>Manual Deductions:</span> <span id="r_ded">0.00</span></div>
            
            <div class="result-row total-net"><span>NET PAY:</span> <span id="r_net">0.00</span></div>
        </div>
        <button class="add-btn" onclick="addEmployee()">CONFIRM & ADD TO LIST</button>
    </div>

    <div class="card full-width">
        <h2>3. Employee List</h2>
        <table id="empTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Basic</th>
                    <th>Gross</th>
                    <th>Net Pay</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="print-section">
    <div class="slip-header">
        <div class="slip-title">
            <h1 id="p_company">COMPANY NAME</h1>
            <p>Official Salary Slip</p>
        </div>
        <div class="slip-logo">
            <img id="p_logo_img" src="" style="display:none;">
        </div>
    </div>

    <div class="slip-info">
        <div>
            <small>EMPLOYEE NAME</small><br>
            <strong id="p_name">John Doe</strong>
        </div>
        <div style="text-align:right;">
            <small>PAY DATE</small><br>
            <strong id="p_date">2025-01-01</strong>
        </div>
    </div>

    <div class="slip-grid">
        <div>
            <div class="col-title">EARNINGS</div>
            <div class="slip-row"><span>Basic Salary</span> <span id="p_basic">0.00</span></div>
            <div class="slip-row"><span>Transport</span> <span id="p_trans">0.00</span></div>
            <div class="slip-row"><span>Housing</span> <span id="p_house">0.00</span></div>
            <div class="slip-row"><span>Other Allowances</span> <span id="p_other_all">0.00</span></div>
            <div class="slip-row" style="font-weight:bold; margin-top:10px; border-top:1px solid #ccc; padding-top:5px;"><span>TOTAL GROSS</span> <span id="p_gross">0.00</span></div>
        </div>

        <div>
            <div class="col-title">DEDUCTIONS</div>
            <div class="slip-row"><span>NPF (Social Security)</span> <span id="p_npf">0.00</span></div>
            <div class="slip-row"><span>PAYE Tax</span> <span id="p_tax">0.00</span></div>
            <div class="slip-row"><span>Staff Loan</span> <span id="p_loan">0.00</span></div>
            <div class="slip-row"><span>Other Deductions</span> <span id="p_other_ded">0.00</span></div>
            <div class="slip-row text-red" style="font-weight:bold; margin-top:10px; border-top:1px solid #ccc; padding-top:5px;"><span>TOTAL DEDUCTIONS</span> <span id="p_total_ded">0.00</span></div>
        </div>
    </div>

    <div class="net-box">
        <p>NET PAYABLE AMOUNT</p>
        <h2 id="p_net">D 0.00</h2>
    </div>

    <div class="footer">
        Generated by Professional Payroll System | Valid in The Gambia
    </div>
</div>

<script>
    // Initialize date to today
    document.getElementById('payDate').valueAsDate = new Date();

    let logoData = "";

    function loadLogo() {
        const file = document.getElementById('logoInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) { logoData = e.target.result; };
            reader.readAsDataURL(file);
        }
    }

    function calculate() {
        // Helper to get numbers
        let num = (id) => parseFloat(document.getElementById(id).value) || 0;

        let basic = num('basic');
        let trans = num('all_trans');
        let house = num('all_house');
        let otherAll = num('all_other');
        
        let loan = num('ded_loan');
        let otherDed = num('ded_other');

        // 1. Calculate Monthly Gross
        let gross = basic + trans + house + otherAll;
        
        // 2. NPF (5% of Basic)
        let npf = basic * 0.05;
        
        // 3. Taxable Income (Monthly)
        // NPF is tax deductible
        let monthlyTaxable = Math.max(0, gross - npf);

        // 4. Annualize for Tax Calculation (Based on your image)
        let annualTaxable = monthlyTaxable * 12;

        let annualTax = 0;
        
        // --- TAX LOGIC FROM IMAGE (Annual Brackets) ---
        // 0 - 36,000 @ 0%
        // 36,001 - 46,000 @ 5%
        // 46,001 - 56,000 @ 10%
        // 56,001 - 66,000 @ 15%
        // 66,001 - 76,000 @ 20%
        // 76,001+ @ 25%

        let remainder = annualTaxable - 36000; // First 36k is free
        
        if (remainder > 0) {
            // Next 10,000 @ 5%
            let chunk = Math.min(remainder, 10000);
            annualTax += chunk * 0.05;
            remainder -= chunk;
        }
        
        if (remainder > 0) {
            // Next 10,000 @ 10%
            let chunk = Math.min(remainder, 10000);
            annualTax += chunk * 0.10;
            remainder -= chunk;
        }

        if (remainder > 0) {
            // Next 10,000 @ 15%
            let chunk = Math.min(remainder, 10000);
            annualTax += chunk * 0.15;
            remainder -= chunk;
        }

        if (remainder > 0) {
            // Next 10,000 @ 20%
            let chunk = Math.min(remainder, 10000);
            annualTax += chunk * 0.20;
            remainder -= chunk;
        }

        if (remainder > 0) {
            // Anything above 76,000 @ 25%
            annualTax += remainder * 0.25;
        }

        // 5. Convert Annual Tax back to Monthly
        let monthlyTax = annualTax / 12;

        let totalDed = npf + monthlyTax + loan + otherDed;
        let net = gross - totalDed;

        // Display on Dashboard
        let fmt = (n) => "D " + n.toLocaleString('en-GM', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        document.getElementById('r_basic').innerText = fmt(basic);
        document.getElementById('r_allow').innerText = fmt(trans + house + otherAll);
        document.getElementById('r_gross').innerText = fmt(gross);
        document.getElementById('r_npf').innerText = fmt(npf);
        document.getElementById('r_tax').innerText = fmt(monthlyTax);
        document.getElementById('r_ded').innerText = fmt(loan + otherDed);
        document.getElementById('r_net').innerText = fmt(net);

        return { basic, trans, house, otherAll, gross, npf, tax: monthlyTax, loan, otherDed, totalDed, net };
    }

    function addEmployee() {
        let name = document.getElementById('empName').value;
        if(!name) { alert("Please enter a name"); return; }
        
        let data = calculate();
        let company = document.getElementById('companyName').value;
        let date = document.getElementById('payDate').value;

        // Add to Table
        let tbody = document.querySelector('#empTable tbody');
        let row = tbody.insertRow();
        
        row.innerHTML = `
            <td>${name}</td>
            <td>${data.basic.toLocaleString(undefined, {minimumFractionDigits:2})}</td>
            <td>${data.gross.toLocaleString(undefined, {minimumFractionDigits:2})}</td>
            <td style="font-weight:bold; color:#27ae60;">${data.net.toLocaleString(undefined, {minimumFractionDigits:2})}</td>
            <td><button class="print-btn" onclick='printSlip(this)'>Print Slip</button></td>
        `;

        // Save data to button for printing
        let btn = row.querySelector('button');
        btn.dataset.info = JSON.stringify({ ...data, name, company, date });

        // Reset Name
        document.getElementById('empName').value = "";
        document.getElementById('basic').value = 0;
        // Optionally clear others...
    }

    function printSlip(btn) {
        let data = JSON.parse(btn.dataset.info);
        let fmt = (n) => "D " + n.toLocaleString('en-GM', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        // Fill Print Section
        document.getElementById('p_company').innerText = data.company;
        document.getElementById('p_name').innerText = data.name;
        document.getElementById('p_date').innerText = data.date;

        if(logoData) {
            let img = document.getElementById('p_logo_img');
            img.src = logoData;
            img.style.display = "block";
        } else {
            document.getElementById('p_logo_img').style.display = "none";
        }

        document.getElementById('p_basic').innerText = fmt(data.basic);
        document.getElementById('p_trans').innerText = fmt(data.trans);
        document.getElementById('p_house').innerText = fmt(data.house);
        document.getElementById('p_other_all').innerText = fmt(data.otherAll);
        document.getElementById('p_gross').innerText = fmt(data.gross);

        document.getElementById('p_npf').innerText = fmt(data.npf);
        document.getElementById('p_tax').innerText = fmt(data.tax);
        document.getElementById('p_loan').innerText = fmt(data.loan);
        document.getElementById('p_other_ded').innerText = fmt(data.otherDed);
        document.getElementById('p_total_ded').innerText = "- " + fmt(data.totalDed);

        document.getElementById('p_net').innerText = fmt(data.net);

        window.print();
    }
</script>

</body>
</html>